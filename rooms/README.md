# HaxBall Rooms

## Overview

This documentation provides information about the HaxBall Rooms project, which focuses on creating and managing custom game rooms on the HaxBall platform. In this context, a "room" refers to a server hosted on HaxBall, utilizing the HaxBall Headless Host API to interact programmatically.

![Website Diagram](https://cdn.discordapp.com/attachments/1097966927630061658/1209133113725165568/Bez_nazwy-1.png?ex=65e5cff6&is=65d35af6&hm=8624b7423f20e0eaacc4835918e9de837ee24b1eb6fefe54a18fde294a19298a&)

## Getting Started

1. Install dependencies:
    ```bash
    npm install
    ```

2. Execute room
    ```bash
    npx tsx room-manager.ts --configFile="RS_NORMAL.ts"
    ```
    
The project includes a room manager that handles CLI commands for creating and managing HaxBall rooms. To execute the room manager, use the following command:

Replace `"RS_NORMAL.ts"` with the desired configuration file for the room.

## Environment Variables

Ensure you have the following environment variables set in your environment configuration:

```bash
CDN_ACCESS_KEY=cdn_key
CDN_SECRET_ACCESS_KEY=cdn_secret
TOKEN=your_jwt_token
```

Replace `your_jwt_token` with the actual JWT token generated by the backend for authentication.

## GitHub Workflow

The project utilizes GitHub Actions as a workflow to automate the deployment process. Upon pushing a commit, the workflow triggers the deployment to the Docker registry.

## Docker Deployment

The deployment process involves pulling the Docker image from the registry and starting the container. The "manager" component handles CLI commands and initiates the execution of the room manager script to create and manage HaxBall rooms.

## Room Configuration

The room configuration is a crucial aspect of the HaxBall Rooms project, defining various parameters for the creation and management of custom game rooms.
The configuration file exports an object that contains two main sections: `source` and `container`. These sections provide information about the HaxBall room and the Docker container used to host it.

### `source` Section

The `source` section defines parameters related to the HaxBall room itself:

- **id:** An identifier for the room, often referred to as `RS` in this context.
  
- **name:** Descriptive name of the room, such as 'REAL_SOCCER', also source code in rooms directory should have exact name `./rooms/REAL_SOCCER/` in this case.

- **stadium:** Specifies the map for the room, identified by the filename within the `./sharedable/assets/maps/` directory.

### `container` Section

The `container` section contains details about the Docker container hosting the HaxBall room:

- **name:** Name assigned to the Docker container, e.g., 'REAL_SOCCER'.

- **host:** IP address of the VPS where the Docker container manager is running. The manager is responsible for creating the Docker container for the HaxBall room.

### Example Configuration

```javascript
export default {
  source: {
    id: 'RS',
    name: 'REAL_SOCCER',
    stadium: 'REAL_SOCCER',
  },

  container: {
    name: 'REAL_SOCCER',
    host: '192.158.1.38',
  },

  room: {
    // haxball api configuration
  }
}
```

## Github Workflow Secrets

- `DOCKER_HUB_USER`
- `DOCKER_HUB_TOKEN`

## Scripts

- `codegen`: Script is used to generate GraphQL types (gql types) based on the provided configuration file (`codegen.yaml`).
